{% extends "base.html" %}

{% block title %}é¢„è§ˆ - Markdown to DOCX Converter{% endblock %}

{% block content %}
<div class="preview-page">
    <div class="preview-header">
        <h2>ğŸ“„ æ–‡æ¡£é¢„è§ˆ</h2>
        <div class="preview-actions">
            <button onclick="window.history.back()" class="btn btn-secondary">
                <span class="icon">â¬…ï¸</span> è¿”å›
            </button>
            <form action="{{ url_for('convert') }}" method="post" style="display: inline;">
                <input type="hidden" name="markdown" value="{{ markdown_content }}">
                <button type="submit" class="btn btn-primary">
                    <span class="icon">ğŸ“¥</span> ä¸‹è½½ DOCX
                </button>
            </form>
        </div>
    </div>

    <div class="preview-container">
        <!-- Markdownæºç  -->
        <div class="preview-panel source-panel">
            <div class="panel-header">
                <h3>ğŸ“ Markdown æºç </h3>
                <button onclick="copySource()" class="btn btn-small">
                    <span class="icon">ğŸ“‹</span> å¤åˆ¶
                </button>
            </div>
            <div class="panel-content">
                <pre id="markdown-source">{{ markdown_content }}</pre>
            </div>
        </div>

        <!-- DOCXé¢„è§ˆ -->
        <div class="preview-panel preview-panel">
            <div class="panel-header">
                <h3>ğŸ“„ DOCX é¢„è§ˆ</h3>
                <div class="preview-controls">
                    <button onclick="toggleWordMode()" id="word-mode-btn" class="btn btn-small">
                        <span class="icon">ğŸ“„</span> Wordæ ·å¼
                    </button>
                </div>
            </div>
            <div class="panel-content">
                <div id="docx-preview" class="docx-preview">
                    {% if error %}
                        <div class="error-message">
                            <span class="icon">âŒ</span>
                            {{ error }}
                        </div>
                    {% else %}
                        <div class="docx-content">
                            {{ preview_content|safe }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="preview-stats">
        <div class="stat-item">
            <span class="stat-label">å­—ç¬¦æ•°:</span>
            <span class="stat-value">{{ markdown_content|length }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">è¡Œæ•°:</span>
            <span class="stat-value">{{ markdown_content.split('\n')|length }}</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">é¢„è§ˆæ¨¡å¼:</span>
            <span class="stat-value" id="preview-mode">åŸºç¡€é¢„è§ˆ</span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// å¤åˆ¶æºç åŠŸèƒ½
function copySource() {
    const sourceText = document.getElementById('markdown-source').textContent;
    navigator.clipboard.writeText(sourceText).then(function() {
        // ç®€å•çš„åé¦ˆ
        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<span class="icon">âœ…</span> å·²å¤åˆ¶';
        setTimeout(() => {
            btn.innerHTML = originalText;
        }, 2000);
    }).catch(function(err) {
        console.error('å¤åˆ¶å¤±è´¥:', err);
    });
}

// Wordæ ·å¼é¢„è§ˆåˆ‡æ¢
let wordMode = false;
function toggleWordMode() {
    const preview = document.getElementById('docx-preview');
    const btn = document.getElementById('word-mode-btn');
    const modeIndicator = document.getElementById('preview-mode');

    wordMode = !wordMode;

    if (wordMode) {
        preview.classList.add('word-mode');
        btn.innerHTML = '<span class="icon">ğŸ¨</span> ç®€åŒ–æ ·å¼';
        modeIndicator.textContent = 'Wordæ ·å¼';
    } else {
        preview.classList.remove('word-mode');
        btn.innerHTML = '<span class="icon">ğŸ“„</span> Wordæ ·å¼';
        modeIndicator.textContent = 'åŸºç¡€é¢„è§ˆ';
    }
}

// é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // é«˜äº®ä»£ç å—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
    document.querySelectorAll('pre code').forEach((block) => {
        // è¿™é‡Œå¯ä»¥æ·»åŠ è¯­æ³•é«˜äº®
        block.style.backgroundColor = '#f8f8f8';
        block.style.padding = '1em';
        block.style.borderRadius = '4px';
        block.style.overflow = 'auto';
    });

    // æ·»åŠ ä¸€äº›åŸºæœ¬çš„æ ·å¼å¢å¼º
    const docxContent = document.querySelector('.docx-content');
    if (docxContent) {
        // ä¸ºæ ‡é¢˜æ·»åŠ æ ·å¼
        docxContent.querySelectorAll('h1, h2, h3, h4, h5, h6').forEach(header => {
            header.style.marginTop = '1.5em';
            header.style.marginBottom = '0.5em';
            header.style.fontWeight = 'bold';
        });

        // ä¸ºæ®µè½æ·»åŠ æ ·å¼
        docxContent.querySelectorAll('p').forEach(p => {
            p.style.marginBottom = '1em';
            p.style.lineHeight = '1.6';
        });
    }
});
</script>
{% endblock %}
